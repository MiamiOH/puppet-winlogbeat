### winlogbeat configuration managed by Puppet (Ruby 1.8 version) ###
---
winlogbeat:
  registry_file: <%= @registry_file %>
  <%- if @event_logs != nil -%>
  event_logs:
    <%- @event_logs.each do |event_log,options| -%>
    - name: <%= event_log %>
      ignore_older: <%= options["ignore_older"] %>
    <%- end -%>
  <%- end -%>

  output:
    <%- if @winlogbeat_config['output']['elasticsearch'] != nil -%>
    elasticsearch:
      hosts:
      <%- @winlogbeat_config['output']['elasticsearch']['hosts'].each do |host| -%>
        - <%= host %>
      <%- end -%>
      <%- if @winlogbeat_config['output']['elasticsearch']['port'] != nil -%>
      port: <%= @winlogbeat_config['output']['elasticsearch']['port'] %>
      <%- end -%>
      <%- if @winlogbeat_config['output']['elasticsearch']['protocol'] != nil -%>
      protocol: "<%= @winlogbeat_config['output']['elasticsearch']['protocol'] %>"
      <%- end -%>
      <%- if @winlogbeat_config['output']['elasticsearch']['username'] != nil -%>
      username: "<%= @winlogbeat_config['output']['elasticsearch']['username'] %>"
      <%- end -%>
      <%- if @winlogbeat_config['output']['elasticsearch']['password'] != nil -%>
      password: "<%= @winlogbeat_config['output']['elasticsearch']['password'] %>"
      <%- end -%>
      <%- if @winlogbeat_config['output']['elasticsearch']['worker'] != nil -%>
      worker: <%= @winlogbeat_config['output']['elasticsearch']['worker'] %>
      <%- end -%>
      <%- if @winlogbeat_config['output']['elasticsearch']['index'] != nil -%>
      index: "<%= @winlogbeat_config['output']['elasticsearch']['index'] %>"
      <%- end -%>
      <%- if @winlogbeat_config['output']['elasticsearch']['path'] != nil -%>
      path: "<%= @winlogbeat_config['output']['elasticsearch']['path'] %>"
      <%- end -%>
      <%- if @winlogbeat_config['output']['elasticsearch']['proxy_url'] != nil -%>
      proxy_url: "<%= @winlogbeat_config['output']['elasticsearch']['proxy_url'] %>"
      <%- end -%>
      <%- if @winlogbeat_config['output']['elasticsearch']['max_retries'] != nil -%>
      max_retries: <%= @winlogbeat_config['output']['elasticsearch']['max_retries'] %>
      <%- end -%>
      <%- if @winlogbeat_config['output']['elasticsearch']['bulk_max_size'] != nil -%>
      bulk_max_size: <%= @winlogbeat_config['output']['elasticsearch']['bulk_max_size'] %>
      <%- end -%>
      <%- if @winlogbeat_config['output']['elasticsearch']['timeout'] != nil -%>
      timeout: <%= @winlogbeat_config['output']['elasticsearch']['timeout'] %>
      <%- end -%>
      <%- if @winlogbeat_config['output']['elasticsearch']['flush_interval'] != nil -%>
      flush_interval: <%= @winlogbeat_config['output']['elasticsearch']['flush_interval'] %>
      <%- end -%>
      <%- if @winlogbeat_config['output']['elasticsearch']['save_topology'] != nil -%>
      save_topology: <%= @winlogbeat_config['output']['elasticsearch']['save_topology'] %>
      <%- end -%>
      <%- if @winlogbeat_config['output']['elasticsearch']['topology_expire'] != nil -%>
      topology_expire: <%= @winlogbeat_config['output']['elasticsearch']['topology_expire'] %>
      <%- end -%>

      <%- if @winlogbeat_config['output']['elasticsearch']['template'] != nil -%>
      template:
        <%- if @winlogbeat_config['output']['elasticsearch']['template']['name'] != nil -%>
        name: "<%= @winlogbeat_config['output']['elasticsearch']['name'] %>"
        <%- end -%>
        <%- if @winlogbeat_config['output']['elasticsearch']['template']['path'] != nil -%>
        path: "<%= @winlogbeat_config['output']['elasticsearch']['path'] %>"
        <%- end -%>
        <%- if @winlogbeat_config['output']['elasticsearch']['template']['overwrite'] != nil -%>
        overwrite: <%= @winlogbeat_config['output']['elasticsearch']['name'] %>
        <%- end -%>
      <%- end -%>

      <%- if @winlogbeat_config['output']['elasticsearch']['tls'] != nil -%>
      tls:
        <%- if @winlogbeat_config['output']['elasticsearch']['tls']['certificate_authorities'] != nil -%>
        certificate_authorities:
        <%- @winlogbeat_config['output']['elasticsearch']['tls']['certificate_authorities'].each do |ca| -%>
          - <%= ca %>
        <%- end -%>
        <%- end -%>
        <%- if @winlogbeat_config['output']['elasticsearch']['tls']['certificate'] != nil -%>
        certificate: "<%= @winlogbeat_config['output']['elasticsearch']['tls']['certificate'] %>"
        <%- end -%>
        <%- if @winlogbeat_config['output']['elasticsearch']['tls']['certificate_key'] != nil -%>
        certificate_key: "<%= @winlogbeat_config['output']['elasticsearch']['tls']['certificate_key'] %>"
        <%- end -%>
        <%- if @winlogbeat_config['output']['elasticsearch']['tls']['insecure'] != nil -%>
        insecure: <%= @winlogbeat_config['output']['elasticsearch']['tls']['insecure'] %>
        <%- end -%>
        <%- if @winlogbeat_config['output']['elasticsearch']['tls']['cipher_suites'] != nil -%>
        cipher_suites:
          <%- @winlogbeat_config['output']['elasticsearch']['tls']['cipher_suites'].each do |cipher_suite| -%>
          - <%= cipher_suite %>
          <%- end -%>
        <%- end -%>
        <%- if @winlogbeat_config['output']['elasticsearch']['tls']['curve_types'] != nil -%>
        curve_types:
          <%- @winlogbeat_config['output']['elasticsearch']['tls']['curve_types'].each do |curve_type| -%>
          - <%= curve_type %>
          <%- end -%>
        <%- end -%>
        <%- if @winlogbeat_config['output']['elasticsearch']['tls']['min_version'] != nil -%>
        min_version: <%= @winlogbeat_config['output']['elasticsearch']['tls']['min_version'] %>
        <%- end -%>
        <%- if @winlogbeat_config['output']['elasticsearch']['tls']['max_version'] != nil -%>
        max_version: <%= @winlogbeat_config['output']['elasticsearch']['tls']['max_version'] %>
        <%- end -%>
      <%- end -%>
    <%- end -%>
    <%- if @winlogbeat_config['output']['logstash'] != nil -%>
    logstash:
      hosts:
      <%- @winlogbeat_config['output']['logstash']['hosts'].each do |host| -%>
        - <%= host %>
      <%- end -%>
      <%- if @winlogbeat_config['output']['logstash']['port'] != nil -%>
      port: <%= @winlogbeat_config['output']['logstash']['port'] %>
      <%- end -%>
      <%- if @winlogbeat_config['output']['logstash']['worker'] != nil -%>
      worker: <%= @winlogbeat_config['output']['logstash']['worker'] %>
      <%- end -%>
      <%- if @winlogbeat_config['output']['logstash']['compression_level'] != nil -%>
      compression_level: <%= @winlogbeat_config['output']['logstash']['compression_level'] %>
      <%- end -%>
      <%- if @winlogbeat_config['output']['logstash']['loadbalance'] != nil -%>
      loadbalance: <%= @winlogbeat_config['output']['logstash']['loadbalance'] %>
      <%- end -%>
      <%- if @winlogbeat_config['output']['logstash']['index'] != nil -%>
      index: <%= @winlogbeat_config['output']['logstash']['index'] %>
      <%- end -%>

      <%- if @winlogbeat_config['output']['logstash']['tls'] != nil -%>
      tls:
        <%- if @winlogbeat_config['output']['logstash']['tls']['certificate_authorities'] != nil -%>
        certificate_authorities:
        <%- @winlogbeat_config['output']['logstash']['tls']['certificate_authorities'].each do |ca| -%>
          - <%= ca %>
        <%- end -%>
        <%- end -%>
        <%- if @winlogbeat_config['output']['logstash']['tls']['certificate'] != nil -%>
        certificate: "<%= @winlogbeat_config['output']['logstash']['tls']['certificate'] %>"
        <%- end -%>
        <%- if @winlogbeat_config['output']['logstash']['tls']['certificate_key'] != nil -%>
        certificate_key: "<%= @winlogbeat_config['output']['logstash']['tls']['certificate_key'] %>"
        <%- end -%>
        <%- if @winlogbeat_config['output']['logstash']['tls']['insecure'] != nil -%>
        insecure: <%= @winlogbeat_config['output']['logstash']['tls']['insecure'] %>
        <%- end -%>
        <%- if @winlogbeat_config['output']['logstash']['tls']['cipher_suites'] != nil -%>
        cipher_suites:
          <%- @winlogbeat_config['output']['logstash']['tls']['cipher_suites'].each do |cipher_suite| -%>
          - <%= cipher_suite %>
          <%- end -%>
        <%- end -%>
        <%- if @winlogbeat_config['output']['logstash']['tls']['curve_types'] != nil -%>
        curve_types:
          <%- @winlogbeat_config['output']['logstash']['tls']['curve_types'].each do |curve_type| -%>
          - <%= curve_type %>
          <%- end -%>
        <%- end -%>
      <%- end -%>
    <%- end -%>
    <%- if @winlogbeat_config['output']['redis'] != nil -%>
    redis:
      <%- if @winlogbeat_config['output']['redis']['host'] != nil -%>
      host: "<%= @winlogbeat_config['output']['redis']['host'] %>"
      <%- end -%>
      <%- if @winlogbeat_config['output']['redis']['port'] != nil -%>
      port: <%= @winlogbeat_config['output']['redis']['port'] %>
      <%- end -%>
      <%- if @winlogbeat_config['output']['redis']['save_topology'] != nil -%>
      save_topology: <%= @winlogbeat_config['output']['redis']['save_topology'] %>
      <%- end -%>
      <%- if @winlogbeat_config['output']['redis']['index'] != nil -%>
      index: "<%= @winlogbeat_config['output']['redis']['index'] %>"
      <%- end -%>
      <%- if @winlogbeat_config['output']['redis']['db'] != nil -%>
      db: <%= @winlogbeat_config['output']['redis']['db'] %>
      <%- end -%>
      <%- if @winlogbeat_config['output']['redis']['db_topology'] != nil -%>
      db_topology: <%= @winlogbeat_config['output']['redis']['db_topology'] %>
      <%- end -%>
      <%- if @winlogbeat_config['output']['redis']['password'] != nil -%>
      password: "<%= @winlogbeat_config['output']['redis']['password'] %>"
      <%- end -%>
      <%- if @winlogbeat_config['output']['redis']['timeout'] != nil -%>
      timeout: <%= @winlogbeat_config['output']['redis']['timeout'] %>
      <%- end -%>
      <%- if @winlogbeat_config['output']['redis']['reconnect_interval'] != nil -%>
      reconnect_interval: <%= @winlogbeat_config['output']['redis']['reconnect_interval'] %>
      <%- end -%>
    <%- end -%>
    <%- if @winlogbeat_config['output']['file'] != nil -%>
    file:
      <%- if @winlogbeat_config['output']['file']['path'] != nil -%>
      path: "<%= @winlogbeat_config['output']['file']['path'] %>"
      <%- end -%>
      <%- if @winlogbeat_config['output']['file']['filename'] != nil -%>
      filename: <%= @winlogbeat_config['output']['file']['filename'] %>
      <%- end -%>
      <%- if @winlogbeat_config['output']['file']['rotate_every_kb'] != nil -%>
      rotate_every_kb: <%= @winlogbeat_config['output']['file']['rotate_every_kb'] %>
      <%- end -%>
      <%- if @winlogbeat_config['output']['file']['number_of_files'] != nil -%>
      number_of_files: <%= @winlogbeat_config['output']['file']['number_of_files'] %>
      <%- end -%>
    <%- end -%>
    <%- if @winlogbeat_config['output']['console'] != nil -%>
    console:
      <%- if @winlogbeat_config['output']['console']['pretty'] != nil -%>
      pretty: <%= @winlogbeat_config['output']['console']['pretty'] %>
      <%- end -%>
    <%- end -%>

  <%- unless @winlogbeat_config['shipper'].empty? -%>
  shipper:
    <%- if @winlogbeat_config['shipper']['name'] != nil -%>
    name: <%= @winlogbeat_config['shipper']['name'] %>
    <%- end -%>
    <%- if @winlogbeat_config['shipper']['tags'] != nil -%>
    tags:
    <%- @winlogbeat_config['shipper']['tags'].each do |tag| -%>
      - <%= tag %>
    <%- end -%>
    <%- end -%>
    <%- if @winlogbeat_config['shipper']['ignore_outgoing'] != nil -%>
    ignore_outgoing: <%= @winlogbeat_config['shipper']['ignore_outgoing'] %>
    <%- end -%>
    <%- if @winlogbeat_config['shipper']['refresh_topology_freq'] != nil -%>
    refresh_topology_freq: <%= @winlogbeat_config['shipper']['refresh_topology_freq'] %>
    <%- end -%>
    <%- if @winlogbeat_config['shipper']['topology_expire'] != nil -%>
    topology_expire: <%= @winlogbeat_config['shipper']['topology_expire'] %>
    <%- end -%>
    <%- if @winlogbeat_config['shipper']['queue_size'] != nil -%>
    queue_size: <%= @winlogbeat_config['shipper']['queue_size'] %>
    <%- end -%>
  <%- end -%>

  <%- unless @winlogbeat_config['logging'].empty? -%>
  logging:
    <%- if @winlogbeat_config['logging']['to_syslog'] != nil -%>
    to_syslog: <%= @winlogbeat_config['logging']['to_syslog'] %>
    <%- end -%>
    <%- if @winlogbeat_config['logging']['to_files'] != nil -%>
    to_files: <%= @winlogbeat_config['logging']['to_files'] %>
    <%- end -%>

    <%- if @winlogbeat_config['logging']['files'] != nil -%>
    files:
      <%- if @winlogbeat_config['logging']['files']['path'] != nil -%>
      path: <%= @winlogbeat_config['logging']['files']['path'] %>
      <%- end -%>
      <%- if @winlogbeat_config['logging']['files']['name'] != nil -%>
      name: <%= @winlogbeat_config['logging']['files']['name'] %>
      <%- end -%>
      <%- if @winlogbeat_config['logging']['files']['rotateeverybytes'] != nil -%>
      rotateeverybytes: <%= @winlogbeat_config['logging']['files']['rotateeverybytes'] %>
      <%- end -%>
      <%- if @winlogbeat_config['logging']['files']['keepfiles'] != nil -%>
      keepfiles: <%= @winlogbeat_config['logging']['files']['keepfiles'] %>
      <%- end -%>
    <%- end -%>

    <%- if @winlogbeat_config['logging']['selectors'] != nil -%>
    selectors:
    <%- @winlogbeat_config['logging']['selectors'].each do |selector| -%>
    - <%= selector %>
    <%- end -%>
    <%- end -%>

    <%- if @winlogbeat_config['logging']['level'] != nil -%>
    level: <%= @winlogbeat_config['logging']['level'] %>
    <%- end -%>
  <%- end -%>

  <%- unless @winlogbeat_config['runoptions'].empty? -%>
  runoptions:
    <%- if @winlogbeat_config['runoptions']['uid'] != nil -%>
    uid=<%= @winlogbeat_config['runoptions']['uid'] %>
    <%- end -%>
    <%- if @winlogbeat_config['runoptions']['gid'] != nil -%>
    gid=<%= @winlogbeat_config['runoptions']['gid'] %>
    <%- end -%>
<%- end -%>
